<!DOCTYPE html>
<html>
<head>
    <title>Claude Usage Reticle - Install</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 15px 25px;
            line-height: 1.4;
            color: #333;
            font-size: 14px;
        }
        h1 { color: #D97706; margin: 0 0 3px 0; font-size: 1.5em; }
        h2 { margin: 0 0 8px 0; font-size: 1em; }
        p { margin: 4px 0; }
        ol, ul { margin: 4px 0; padding-left: 18px; }
        li { margin: 2px 0; }

        .header { display: flex; gap: 30px; align-items: center; margin-bottom: 15px; }
        .header-text { flex: 0 0 auto; }
        .header-text p { color: #666; margin: 0; font-size: 13px; }

        .demo {
            flex: 1;
            background: #1a1a1a;
            padding: 10px 20px;
            border-radius: 6px;
        }
        .demo-bar {
            position: relative;
            height: 18px;
            background: #333;
            border-radius: 4px;
            border: 1px solid #444;
            margin: 6px 0;
        }
        .demo-fill { height: 100%; background: #3b82f6; border-radius: 4px; }
        .demo-reticle { position: absolute; width: 2px; height: 100%; top: 0; }
        .demo-reticle.usage { background: #3b82f6; }
        .demo-reticle.usage::after {
            content: ''; position: absolute; left: -3px; bottom: -5px;
            border-left: 4px solid transparent; border-right: 4px solid transparent;
            border-bottom: 5px solid #3b82f6;
        }
        .demo-reticle.delta { background: hsl(0, 65%, 38%); }
        .demo-reticle.delta::before {
            content: ''; position: absolute; left: -3px; top: -5px;
            border-left: 4px solid transparent; border-right: 4px solid transparent;
            border-top: 5px solid hsl(0, 65%, 38%);
        }
        .demo-label {
            position: absolute; left: 50%; transform: translateX(-50%);
            color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600;
        }
        .demo-label.usage { background: #3b82f6; bottom: -20px; top: auto; }
        .demo-label.delta { background: hsl(0, 65%, 38%); top: -20px; }
        .demo-glow { position: absolute; height: 100%; top: 0; border-radius: 4px;
            box-shadow: inset 0 0 10px hsla(0, 70%, 40%, 0.6);
            background: hsla(0, 45%, 50%, 0.12); }
        .demo-text { color: #888; font-size: 12px; }
        .demo-hint { color: #f87171; font-size: 11px; margin-top: 4px; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .card {
            border-radius: 6px;
            padding: 12px;
            border: 2px solid #3b82f6;
            background: #eff6ff;
        }
        .card.yellow {
            border-color: #D97706;
            background: #FFFBEB;
        }
        .card h2 { border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; }
        .card.yellow .badge { background: #D97706; }

        .badge {
            background: #3b82f6; color: white; font-size: 10px;
            padding: 2px 6px; border-radius: 3px; margin-left: 6px;
        }

        .setup-box {
            background: #fef2f2;
            border: 1px solid #dc2626;
            border-radius: 5px;
            padding: 8px 10px;
            margin: 8px 0;
            font-size: 12px;
        }
        .setup-box strong { color: #dc2626; }

        .btn {
            display: inline-block;
            padding: 8px 14px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            border: none;
            cursor: pointer;
            color: white;
        }
        .btn-blue { background: #3b82f6; }
        .btn-blue:hover { background: #2563eb; }
        .btn-green { background: #16a34a; }
        .btn-green:hover { background: #15803d; }
        .btn-gray { background: #9ca3af; color: #fff; }
        .btn-gray:hover { background: #6b7280; }
        .btn.copied { background: #16a34a; }

        .bookmarklet-row { display: flex; gap: 8px; align-items: center; margin: 8px 0; flex-wrap: wrap; }
        .drag-hint { font-size: 12px; color: #16a34a; margin-top: 6px; padding: 6px 8px; border-radius: 4px; background: #f0fdf4; }
        .drag-hint.firefox { background: #fef2f2; color: #991b1b; }
        .drag-hint.muted { color: #9ca3af; background: transparent; }

        .how-to-read {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 30px;
            font-size: 13px;
        }
        .how-to-read ul { margin: 0; }

        .footer {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid #ddd;
            color: #888;
            font-size: 12px;
        }
        .footer a { color: #666; }

        code { background: #e5e5e5; padding: 1px 4px; border-radius: 3px; font-size: 11px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-text">
            <h1>Claude Usage Reticle</h1>
            <p>See where your usage <em>should</em> be based on time in reset window</p>
        </div>
        <div class="demo">
            <div class="demo-text">58% used | Resets Sat 10:59 AM</div>
            <div class="demo-bar">
                <div class="demo-fill" style="width: 58%"></div>
                <div class="demo-glow" style="left: 45%; width: 13%"></div>
                <div class="demo-reticle delta" style="left: 45%"><div class="demo-label delta">1d 2h over</div></div>
                <div class="demo-reticle usage" style="left: 58%"><div class="demo-label usage">Fri 3PM</div></div>
            </div>
            <div class="demo-hint">‚Üë 1d 2h over budget - usage at Fri 3PM, should be at NOW</div>
        </div>
    </div>

    <div class="main-grid">
        <div class="card">
            <h2>Option 1: Tampermonkey <span class="badge">Recommended</span></h2>
            <p>Auto-runs every time you visit the usage page.</p>
            <ol>
                <li>Install <a href="https://www.tampermonkey.net/" target="_blank">Tampermonkey</a></li>
                <li>Enable script injection (see below)</li>
                <li>Click: <a class="btn btn-blue" href="https://github.com/KatsuJinCode/claude-usage-reticle/raw/main/usage-reticle.user.js">Install Script</a></li>
            </ol>
            <div class="setup-box">
                <strong>‚ö†Ô∏è Chrome/Edge setup required:</strong><br>
                <strong>v138+:</strong> Right-click Tampermonkey ‚Üí Manage Extension ‚Üí Enable "Allow User Scripts"<br>
                <strong>Older:</strong> <code>chrome://extensions</code> ‚Üí Enable Developer Mode<br>
                <span style="color: #666;">Firefox/Safari: No setup needed</span>
            </div>
        </div>

        <div class="card yellow">
            <h2>Option 2: Bookmarklet</h2>
            <p>No extension needed. Click manually each time.</p>
            <div class="bookmarklet-row">
                <a class="btn" id="drag-btn" href="javascript:(function(){if(!location.href.includes(%22claude.ai%22)){alert(%22Go to claude.ai/settings/usage first!%22);return}var s=document.createElement(%22style%22);s.textContent=%22.usage-reticle{position:absolute;width:2px;height:100%25;background:%233b82f6;box-shadow:0 0 2px rgba(0,0,0,.5);pointer-events:none;z-index:10;top:0}.usage-reticle::after{content:'';position:absolute;left:-3px;bottom:-5px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-bottom:5px solid %233b82f6}.usage-reticle-label{position:absolute;bottom:-22px;left:50%25;transform:translateX(-50%25);background:%233b82f6;color:%23fff;padding:1px 4px;border-radius:2px;font-size:9px;font-weight:600;white-space:nowrap}.delta-reticle{position:absolute;width:2px;height:100%25;box-shadow:0 0 2px rgba(0,0,0,.5);pointer-events:none;z-index:10;top:0}.delta-reticle::before{content:'';position:absolute;left:-3px;top:-5px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent}.delta-reticle-label{position:absolute;top:-22px;left:50%25;transform:translateX(-50%25);color:%23fff;padding:1px 4px;border-radius:2px;font-size:9px;font-weight:600;white-space:nowrap}.reticle-glow{position:absolute;height:100%25;top:0;pointer-events:none;z-index:4;border-radius:4px}%22;document.head.appendChild(s);var days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];function fmtTime(d,short){var day=days[d.getDay()];var h=d.getHours();var m=d.getMinutes();var ap=h%3E=12?'PM':'AM';h=h%2512;if(h===0)h=12;var ts=h+':'+(m%3C10?'0':'')+m+' '+ap;return short?ts:day+' '+ts}function fmtDelta(hrs){var over=hrs%3E=0;hrs=Math.abs(hrs);var d=Math.floor(hrs/24);var h=Math.floor(hrs%2524);var m=Math.round((hrs-Math.floor(hrs))*60);var t='';if(d%3E0)t=d+'d '+h+'h';else if(h%3E0)t=h+'h'+(m%3E0?' '+m+'m':'');else t=m+'m';return t+' '+(over?'over':'under')}function getColor(pct){var p=Math.min(Math.abs(pct)/100,1);if(pct%3C0){var sat=5+p*65;var lit=95-p*60;return'hsl(142,'+sat+'%25,'+lit+'%25)'}else{var sat=5+p*75;var lit=95-p*55;return'hsl(0,'+sat+'%25,'+lit+'%25)'}}document.querySelectorAll(%22div.flex.flex-row.gap-x-8.justify-between.items-center%22).forEach(function(c){var p=c.querySelector(%22p.text-text-400.whitespace-nowrap%22);if(!p)return;var t=p.textContent;var titleEl=c.querySelector(%22p.text-text-100%22);var isSession=titleEl%26%26titleEl.textContent.toLowerCase().includes(%22current session%22);var windowHrs=isSession?5:168;var hrsUntil,reset;var m1=t.match(/in\s+(?:(\d+)\s*hr?)?\s*(?:(\d+)\s*min)?/i);if(m1%26%26(m1[1]||m1[2])){hrsUntil=parseInt(m1[1]||0)+(parseInt(m1[2]||0)/60);reset=new Date(Date.now()+hrsUntil*3600000)}else{var m2=t.match(/(sun|mon|tue|wed|thu|fri|sat)\w*\s+(\d+):(\d+)\s*(am|pm)/i);if(!m2)return;var h=parseInt(m2[2]);if(m2[4].toLowerCase()===%22pm%22%26%26h!==12)h+=12;if(m2[4].toLowerCase()===%22am%22%26%26h===12)h=0;var di={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};var rd=di[m2[1].toLowerCase().slice(0,3)];var now=new Date();reset=new Date();reset.setHours(h,parseInt(m2[3]),0,0);var d=rd-now.getDay();if(d%3C0)d+=7;if(d===0%26%26reset%3C=now)d=7;reset.setDate(now.getDate()+d);hrsUntil=(reset-now)/3600000}var nowPos=Math.max(0,Math.min(100,((windowHrs-hrsUntil)/windowHrs)*100));var bar=c.querySelector(%22div.bg-bg-000.rounded.border.h-4%22);if(!bar)return;var fill=bar.querySelector(%22div%22);var usagePos=0;if(fill){var w=fill.style.width;if(w)usagePos=parseFloat(w)}var windowStart=new Date(reset.getTime()-windowHrs*3600000);var usageHrs=(usagePos/100)*windowHrs;var usageTime=new Date(windowStart.getTime()+usageHrs*3600000);var usageLbl=fmtTime(usageTime,isSession);var diffPct=usagePos-nowPos;var diffHrs=(diffPct/100)*windowHrs;var deltaLbl=fmtDelta(diffHrs);var color=getColor(diffPct);var intensity=Math.min(Math.abs(diffPct)/100,1);bar.style.position=%22relative%22;bar.style.overflow=%22visible%22;bar.querySelectorAll(%22.delta-reticle,.usage-reticle,.reticle-glow%22).forEach(function(el){el.remove()});if(diffPct%3E0){var glow=document.createElement(%22div%22);glow.className=%22reticle-glow%22;glow.style.left=nowPos+'%25';glow.style.width=Math.abs(diffPct)+'%25';glow.style.boxShadow='inset 0 0 '+(4+intensity*8)+'px hsla(0,'+(20+intensity*60)+'%25,'+(50-intensity*20)+'%25,'+(0.3+intensity*0.4)+')';glow.style.background='hsla(0,'+(10+intensity*40)+'%25,50%25,'+(0.05+intensity*0.1)+')';bar.appendChild(glow)}else if(diffPct%3C0){var glow=document.createElement(%22div%22);glow.className=%22reticle-glow%22;glow.style.left=usagePos+'%25';glow.style.width=Math.abs(diffPct)+'%25';glow.style.boxShadow='inset 0 0 '+(4+intensity*8)+'px hsla(142,'+(20+intensity*50)+'%25,'+(45-intensity*15)+'%25,'+(0.3+intensity*0.4)+')';glow.style.background='hsla(142,'+(10+intensity*40)+'%25,45%25,'+(0.05+intensity*0.1)+')';bar.appendChild(glow)}var dr=document.createElement(%22div%22);dr.className=%22delta-reticle%22;dr.style.left=nowPos+'%25';dr.style.background=color;var arrowStyle=document.createElement(%22style%22);arrowStyle.textContent='.delta-reticle::before{border-top:5px solid '+color+'}';dr.appendChild(arrowStyle);var dlbl=document.createElement(%22div%22);dlbl.className=%22delta-reticle-label%22;dlbl.style.background=color;dlbl.textContent=deltaLbl;dr.appendChild(dlbl);bar.appendChild(dr);var ur=document.createElement(%22div%22);ur.className=%22usage-reticle%22;ur.style.left=usagePos+'%25';var ulbl=document.createElement(%22div%22);ulbl.className=%22usage-reticle-label%22;ulbl.textContent=usageLbl;ur.appendChild(ulbl);bar.appendChild(ur)})})();">üìç Usage Reticle</a>
                <button class="btn" id="copy-btn" onclick="copyBookmarklet()">üìã Copy</button>
            </div>
            <div id="drag-hint" class="drag-hint"></div>
            <p style="font-size: 12px; color: #666; margin-top: 6px;">Then go to <a href="https://claude.ai/settings/usage" target="_blank">claude.ai/settings/usage</a> and click the bookmark</p>
        </div>
    </div>

    <div class="how-to-read">
        <div>
            <strong>How to read:</strong>
            <ul>
                <li><span style="color:#3b82f6">‚ñ†</span> <strong>Blue reticle</strong> = your usage (shows equivalent day/time)</li>
                <li><span style="color:#22c55e">‚ñ†</span> <strong>Green</strong> = under budget (e.g., "2h 30m under")</li>
                <li><span style="color:#dc2626">‚ñ†</span> <strong>Red</strong> = over budget (e.g., "1d 5h over")</li>
                <li>Glow intensity = how far off you are</li>
            </ul>
        </div>
        <div>
            <strong>Notes:</strong>
            <ul>
                <li>Bookmarklet runs once per click</li>
                <li>Works with session + weekly limits</li>
                <li><a href="https://www.tampermonkey.net/faq.php" target="_blank">Tampermonkey FAQ</a></li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <a href="https://github.com/KatsuJinCode/claude-usage-reticle" target="_blank">GitHub</a> ¬∑ Made for the Claude community. Not affiliated with Anthropic.
    </div>

    <script>
        var ua = navigator.userAgent;
        var isFirefox = ua.includes('Firefox');
        var isChrome = ua.includes('Chrome') || ua.includes('Edg/');

        var dragBtn = document.getElementById('drag-btn');
        var copyBtn = document.getElementById('copy-btn');
        var dragHint = document.getElementById('drag-hint');

        if (isFirefox) {
            dragBtn.className = 'btn btn-gray';
            dragBtn.style.cursor = 'not-allowed';
            copyBtn.className = 'btn btn-green';
            dragHint.className = 'drag-hint firefox';
            dragHint.innerHTML = 'ü¶ä <strong>Firefox detected:</strong> Drag doesn\'t work here. Click <strong>Copy</strong>, then create a new bookmark and paste as the URL.';
        } else if (isChrome) {
            dragBtn.className = 'btn btn-green';
            dragBtn.style.cursor = 'grab';
            copyBtn.className = 'btn btn-gray';
            dragHint.innerHTML = 'üåê <strong>Chrome detected:</strong> Just drag this button up to your bookmarks bar!';
        } else {
            dragBtn.className = 'btn btn-blue';
            dragBtn.style.cursor = 'grab';
            copyBtn.className = 'btn btn-blue';
            dragHint.innerHTML = 'Drag to bookmarks bar, or Copy ‚Üí create bookmark ‚Üí paste as URL';
            dragHint.className = 'drag-hint muted';
        }

        function copyBookmarklet() {
            var btn = document.getElementById('copy-btn');
            var code = document.getElementById('drag-btn').getAttribute('href');
            navigator.clipboard.writeText(code).then(function() {
                btn.textContent = '‚úì Copied!';
                btn.classList.add('copied');
                setTimeout(function() { btn.textContent = 'üìã Copy'; btn.classList.remove('copied'); }, 2000);
            });
        }
    </script>
</body>
</html>
